---
import Base from "../../layouts/Base.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import PostList from "../../components/PostList.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog", ({ data }) => !data.draft);
  const tags = [...new Set(posts.flatMap((p) => p.data.tags))];

  return tags.map((tag) => ({
    params: { tag },
    props: {
      tag,
      posts: posts
        .filter((p) => p.data.tags.includes(tag))
        .sort((a, b) => b.data.date.getTime() - a.data.date.getTime()),
    },
  }));
}

const { tag, posts } = Astro.props;
---

<Base title={`#${tag}`} description={`Posts tagged with "${tag}".`}>
  <Header />
  <main>
    <h1 class="page-title">
      <a href="/blog/" class="back">&larr; blog</a>
      <span>#{tag}</span>
    </h1>
    <PostList posts={posts} />
  </main>
  <Footer />
</Base>

<style>
  .page-title {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    letter-spacing: -0.02em;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .back {
    font-size: 0.8rem;
    font-weight: 400;
    color: var(--text-muted);
    text-decoration: none;
  }

  .back:hover {
    color: var(--accent);
  }
</style>
